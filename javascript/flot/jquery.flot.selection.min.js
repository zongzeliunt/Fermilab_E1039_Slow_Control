(function(a){function b(m){var q={first:{x:-1,y:-1},second:{x:-1,y:-1},show:false,active:false};var d={};var n=null;function g(s){if(q.active){c(s);m.getPlaceholder().trigger("plotselecting",[j()])}}function o(s){if(s.which!=1){return}document.body.focus();if(document.onselectstart!==undefined&&d.onselectstart==null){d.onselectstart=document.onselectstart;document.onselectstart=function(){return false}}if(document.ondrag!==undefined&&d.ondrag==null){d.ondrag=document.ondrag;document.ondrag=function(){return false}}f(q.first,s);q.active=true;n=function(t){i(t)};a(document).one("mouseup",n)}function i(s){n=null;if(document.onselectstart!==undefined){document.onselectstart=d.onselectstart}if(document.ondrag!==undefined){document.ondrag=d.ondrag}q.active=false;c(s);if(k()){h()}else{m.getPlaceholder().trigger("plotunselected",[]);m.getPlaceholder().trigger("plotselecting",[null])}return false}function j(){if(!k()){return null}var u={},t=q.first,s=q.second;a.each(m.getAxes(),function(v,w){if(w.used){var y=w.c2p(t[w.direction]),x=w.c2p(s[w.direction]);u[v]={from:Math.min(y,x),to:Math.max(y,x)}}});return u}function h(){var s=j();m.getPlaceholder().trigger("plotselected",[s]);if(s.xaxis&&s.yaxis){m.getPlaceholder().trigger("selected",[{x1:s.xaxis.from,y1:s.yaxis.from,x2:s.xaxis.to,y2:s.yaxis.to}])}}function l(t,u,s){return u<t?t:(u>s?s:u)}function f(w,t){var v=m.getOptions();var u=m.getPlaceholder().offset();var s=m.getPlotOffset();w.x=l(0,t.pageX-u.left-s.left,m.width());w.y=l(0,t.pageY-u.top-s.top,m.height());if(v.selection.mode=="y"){w.x=w==q.first?0:m.width()}if(v.selection.mode=="x"){w.y=w==q.first?0:m.height()}}function c(s){if(s.pageX==null){return}f(q.second,s);if(k()){q.show=true;m.triggerRedrawOverlay()}else{r(true)}}function r(s){if(q.show){q.show=false;m.triggerRedrawOverlay();if(!s){m.getPlaceholder().trigger("plotunselected",[])}}}function e(w,v){var s,z,y,A,x=m.getAxes();for(var t in x){s=x[t];if(s.direction==v){A=v+s.n+"axis";if(!w[A]&&s.n==1){A=v+"axis"}if(w[A]){z=w[A].from;y=w[A].to;break}}}if(!w[A]){s=v=="x"?m.getXAxes()[0]:m.getYAxes()[0];z=w[v+"1"];y=w[v+"2"]}if(z!=null&&y!=null&&z>y){var u=z;z=y;y=u}return{from:z,to:y,axis:s}}function p(v,u){var t,s,w=m.getOptions();if(w.selection.mode=="y"){q.first.x=0;q.second.x=m.width()}else{s=e(v,"x");q.first.x=s.axis.p2c(s.from);q.second.x=s.axis.p2c(s.to)}if(w.selection.mode=="x"){q.first.y=0;q.second.y=m.height()}else{s=e(v,"y");q.first.y=s.axis.p2c(s.from);q.second.y=s.axis.p2c(s.to)}q.show=true;m.triggerRedrawOverlay();if(!u&&k()){h()}}function k(){var s=5;return Math.abs(q.second.x-q.first.x)>=s&&Math.abs(q.second.y-q.first.y)>=s}m.clearSelection=r;m.setSelection=p;m.getSelection=j;m.hooks.bindEvents.push(function(t,s){var u=t.getOptions();if(u.selection.mode!=null){s.mousemove(g);s.mousedown(o)}});m.hooks.drawOverlay.push(function(v,D){if(q.show&&k()){var u=v.getPlotOffset();var s=v.getOptions();D.save();D.translate(u.left,u.top);var z=a.color.parse(s.selection.color);D.strokeStyle=z.scale("a",0.8).toString();D.lineWidth=1;D.lineJoin="round";D.fillStyle=z.scale("a",0.4).toString();var B=Math.min(q.first.x,q.second.x),A=Math.min(q.first.y,q.second.y),C=Math.abs(q.second.x-q.first.x),t=Math.abs(q.second.y-q.first.y);D.fillRect(B,A,C,t);D.strokeRect(B,A,C,t);D.restore()}});m.hooks.shutdown.push(function(t,s){s.unbind("mousemove",g);s.unbind("mousedown",o);if(n){a(document).unbind("mouseup",n)}})}a.plot.plugins.push({init:b,options:{selection:{mode:null,color:"#e8cfac"}},name:"selection",version:"1.1"})})(jQuery);
(function(b){function c(G){var q=null;var A=null;var n=null;var D=null;var j=null;var M=0;var I=true;var k=10;var e=0.95;var B=0;var u=false;var z=false;var l=[];G.hooks.processOptions.push(r);G.hooks.bindEvents.push(g);function r(O,N){if(N.series.pie.show){N.grid.show=false;if(N.series.pie.label.show=="auto"){if(N.legend.show){N.series.pie.label.show=false}else{N.series.pie.label.show=true}}if(N.series.pie.radius=="auto"){if(N.series.pie.label.show){N.series.pie.radius=3/4}else{N.series.pie.radius=1}}if(N.series.pie.tilt>1){N.series.pie.tilt=1}if(N.series.pie.tilt<0){N.series.pie.tilt=0}O.hooks.processDatapoints.push(H);O.hooks.drawOverlay.push(E);O.hooks.draw.push(t)}}function g(P,O){var N=P.getOptions();if(N.series.pie.show&&N.grid.hoverable){O.unbind("mousemove").mousemove(v)}if(N.series.pie.show&&N.grid.clickable){O.unbind("click").click(o)}}function F(O){var P="";function N(S,T){if(!T){T=0}for(var R=0;R<S.length;++R){for(var Q=0;Q<T;Q++){P+="\t"}if(typeof S[R]=="object"){P+=""+R+":\n";N(S[R],T+1)}else{P+=""+R+": "+S[R]+"\n"}}}N(O);alert(P)}function h(P){for(var N=0;N<P.length;++N){var O=parseFloat(P[N].data[0][1]);if(O){M+=O}}}function H(Q,N,O,P){if(!u){u=true;q=Q.getCanvas();A=b(q).parent();a=Q.getOptions();Q.setData(L(Q.getData()))}}function K(){B=A.children().filter(".legend").children().width();n=Math.min(q.width,(q.height/a.series.pie.tilt))/2;j=(q.height/2)+a.series.pie.offset.top;D=(q.width/2);if(a.series.pie.offset.left=="auto"){if(a.legend.position.match("w")){D+=B/2}else{D-=B/2}}else{D+=a.series.pie.offset.left}if(D<n){D=n}else{if(D>q.width-n){D=q.width-n}}}function d(O){for(var N=0;N<O.length;++N){if(typeof(O[N].data)=="number"){O[N].data=[[1,O[N].data]]}else{if(typeof(O[N].data)=="undefined"||typeof(O[N].data[0])=="undefined"){if(typeof(O[N].data)!="undefined"&&typeof(O[N].data.label)!="undefined"){O[N].label=O[N].data.label}O[N].data=[[1,0]]}}}return O}function L(Q){Q=d(Q);h(Q);var O=0;var S=0;var N=a.series.pie.combine.color;var R=[];for(var P=0;P<Q.length;++P){Q[P].data[0][1]=parseFloat(Q[P].data[0][1]);if(!Q[P].data[0][1]){Q[P].data[0][1]=0}if(Q[P].data[0][1]/M<=a.series.pie.combine.threshold){O+=Q[P].data[0][1];S++;if(!N){N=Q[P].color}}else{R.push({data:[[1,Q[P].data[0][1]]],color:Q[P].color,label:Q[P].label,angle:(Q[P].data[0][1]*(Math.PI*2))/M,percent:(Q[P].data[0][1]/M*100)})}}if(S>0){R.push({data:[[1,O]],color:N,label:a.series.pie.combine.label,angle:(O*(Math.PI*2))/M,percent:(O/M*100)})}return R}function t(S,O){if(!A){return}ctx=O;K();var T=S.getData();var Q=0;while(I&&Q<k){I=false;if(Q>0){n*=e}Q+=1;N();if(a.series.pie.tilt<=0.8){P()}R()}if(Q>=k){N();A.prepend('<div class="error">Could not draw pie with labels contained inside canvas</div>')}if(S.setSeries&&S.insertLegend){S.setSeries(T);S.insertLegend()}function N(){ctx.clearRect(0,0,q.width,q.height);A.children().filter(".pieLabel, .pieLabelBackground").remove()}function P(){var Y=5;var Z=15;var V=10;var X=0.02;if(a.series.pie.radius>1){var W=a.series.pie.radius}else{var W=n*a.series.pie.radius}if(W>=(q.width/2)-Y||W*a.series.pie.tilt>=(q.height/2)-Z||W<=V){return}ctx.save();ctx.translate(Y,Z);ctx.globalAlpha=X;ctx.fillStyle="#000";ctx.translate(D,j);ctx.scale(1,a.series.pie.tilt);for(var U=1;U<=V;U++){ctx.beginPath();ctx.arc(0,0,W,0,Math.PI*2,false);ctx.fill();W-=U}ctx.restore()}function R(){startAngle=Math.PI*a.series.pie.startAngle;if(a.series.pie.radius>1){var Y=a.series.pie.radius}else{var Y=n*a.series.pie.radius}ctx.save();ctx.translate(D,j);ctx.scale(1,a.series.pie.tilt);ctx.save();var X=startAngle;for(var V=0;V<T.length;++V){T[V].startAngle=X;W(T[V].angle,T[V].color,true)}ctx.restore();ctx.save();ctx.lineWidth=a.series.pie.stroke.width;X=startAngle;for(var V=0;V<T.length;++V){W(T[V].angle,a.series.pie.stroke.color,false)}ctx.restore();C(ctx);if(a.series.pie.label.show){U()}ctx.restore();function W(ab,Z,aa){if(ab<=0){return}if(aa){ctx.fillStyle=Z}else{ctx.strokeStyle=Z;ctx.lineJoin="round"}ctx.beginPath();if(Math.abs(ab-Math.PI*2)>1e-9){ctx.moveTo(0,0)}else{if(b.browser.msie){ab-=0.0001}}ctx.arc(0,0,Y,X,X+ab,false);ctx.closePath();X+=ab;if(aa){ctx.fill()}else{ctx.stroke()}}function U(){var ac=startAngle;if(a.series.pie.label.radius>1){var ab=a.series.pie.label.radius}else{var ab=n*a.series.pie.label.radius}for(var aa=0;aa<T.length;++aa){if(T[aa].percent>=a.series.pie.label.threshold*100){Z(T[aa],ac,aa)}ac+=T[aa].angle}function Z(ap,ae,aj){if(ap.data[0][1]==0){return}var ar=a.legend.labelFormatter,aq,ag=a.series.pie.label.formatter;if(ar){aq=ar(ap.label,ap)}else{aq=ap.label}if(ag){aq=ag(aq,ap)}var af=((ae+ap.angle)+ae)/2;var ao=D+Math.round(Math.cos(af)*ab);var am=j+Math.round(Math.sin(af)*ab)*a.series.pie.tilt;var ah='<span class="pieLabel" id="pieLabel'+aj+'" style="position:absolute;top:'+am+"px;left:"+ao+'px;">'+aq+"</span>";A.append(ah);var an=A.children("#pieLabel"+aj);var ai=(am-an.height()/2);var ad=(ao-an.width()/2);an.css("top",ai);an.css("left",ad);if(0-ai>0||0-ad>0||q.height-(ai+an.height())<0||q.width-(ad+an.width())<0){I=true}if(a.series.pie.label.background.opacity!=0){var ak=a.series.pie.label.background.color;if(ak==null){ak=ap.color}var al="top:"+ai+"px;left:"+ad+"px;";b('<div class="pieLabelBackground" style="position:absolute;width:'+an.width()+"px;height:"+an.height()+"px;"+al+"background-color:"+ak+';"> </div>').insertBefore(an).css("opacity",a.series.pie.label.background.opacity)}}}}}function C(N){if(a.series.pie.innerRadius>0){N.save();innerRadius=a.series.pie.innerRadius>1?a.series.pie.innerRadius:n*a.series.pie.innerRadius;N.globalCompositeOperation="destination-out";N.beginPath();N.fillStyle=a.series.pie.stroke.color;N.arc(0,0,innerRadius,0,Math.PI*2,false);N.fill();N.closePath();N.restore();N.save();N.beginPath();N.strokeStyle=a.series.pie.stroke.color;N.arc(0,0,innerRadius,0,Math.PI*2,false);N.stroke();N.closePath();N.restore()}}function f(Q,R){for(var S=false,P=-1,N=Q.length,O=N-1;++P<N;O=P){((Q[P][1]<=R[1]&&R[1]<Q[O][1])||(Q[O][1]<=R[1]&&R[1]<Q[P][1]))&&(R[0]<(Q[O][0]-Q[P][0])*(R[1]-Q[P][1])/(Q[O][1]-Q[P][1])+Q[P][0])&&(S=!S)}return S}function w(N,Q){var T=G.getData(),P=G.getOptions(),S=P.series.pie.radius>1?P.series.pie.radius:n*P.series.pie.radius;for(var O=0;O<T.length;++O){var R=T[O];if(R.pie.show){ctx.save();ctx.beginPath();ctx.moveTo(0,0);ctx.arc(0,0,S,R.startAngle,R.startAngle+R.angle,false);ctx.closePath();x=N-D;y=Q-j;if(ctx.isPointInPath){if(ctx.isPointInPath(N-D,Q-j)){ctx.restore();return{datapoint:[R.percent,R.data],dataIndex:0,series:R,seriesIndex:O}}}else{p1X=(S*Math.cos(R.startAngle));p1Y=(S*Math.sin(R.startAngle));p2X=(S*Math.cos(R.startAngle+(R.angle/4)));p2Y=(S*Math.sin(R.startAngle+(R.angle/4)));p3X=(S*Math.cos(R.startAngle+(R.angle/2)));p3Y=(S*Math.sin(R.startAngle+(R.angle/2)));p4X=(S*Math.cos(R.startAngle+(R.angle/1.5)));p4Y=(S*Math.sin(R.startAngle+(R.angle/1.5)));p5X=(S*Math.cos(R.startAngle+R.angle));p5Y=(S*Math.sin(R.startAngle+R.angle));arrPoly=[[0,0],[p1X,p1Y],[p2X,p2Y],[p3X,p3Y],[p4X,p4Y],[p5X,p5Y]];arrPoint=[x,y];if(f(arrPoly,arrPoint)){ctx.restore();return{datapoint:[R.percent,R.data],dataIndex:0,series:R,seriesIndex:O}}}ctx.restore()}}return null}function v(N){m("plothover",N)}function o(N){m("plotclick",N)}function m(N,T){var O=G.offset(),Q=parseInt(T.pageX-O.left),P=parseInt(T.pageY-O.top),V=w(Q,P);if(a.grid.autoHighlight){for(var R=0;R<l.length;++R){var S=l[R];if(S.auto==N&&!(V&&S.series==V.series)){s(S.series)}}}if(V){p(V.series,N)}var U={pageX:T.pageX,pageY:T.pageY};A.trigger(N,[U,V])}function p(O,P){if(typeof O=="number"){O=series[O]}var N=J(O);if(N==-1){l.push({series:O,auto:P});G.triggerRedrawOverlay()}else{if(!P){l[N].auto=false}}}function s(O){if(O==null){l=[];G.triggerRedrawOverlay()}if(typeof O=="number"){O=series[O]}var N=J(O);if(N!=-1){l.splice(N,1);G.triggerRedrawOverlay()}}function J(P){for(var N=0;N<l.length;++N){var O=l[N];if(O.series==P){return N}}return -1}function E(Q,R){var N=Q.getOptions();var P=N.series.pie.radius>1?N.series.pie.radius:n*N.series.pie.radius;R.save();R.translate(D,j);R.scale(1,N.series.pie.tilt);for(i=0;i<l.length;++i){O(l[i].series)}C(R);R.restore();function O(S){if(S.angle<0){return}R.fillStyle="rgba(255, 255, 255, "+N.series.pie.highlight.opacity+")";R.beginPath();if(Math.abs(S.angle-Math.PI*2)>1e-9){R.moveTo(0,0)}R.arc(0,0,P,S.startAngle,S.startAngle+S.angle,false);R.closePath();R.fill()}}}var a={series:{pie:{show:false,radius:"auto",innerRadius:0,startAngle:3/2,tilt:1,offset:{top:0,left:"auto"},stroke:{color:"#FFF",width:1},label:{show:"auto",formatter:function(d,e){return'<div style="font-size:x-small;text-align:center;padding:2px;color:'+e.color+';">'+d+"<br/>"+Math.round(e.percent)+"%</div>"},radius:1,background:{color:null,opacity:0},threshold:0},combine:{threshold:-1,color:null,label:"Other"},highlight:{opacity:0.5}}}};b.plot.plugins.push({init:c,options:a,name:"pie",version:"1.0"})})(jQuery);